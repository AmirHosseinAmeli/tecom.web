<div ng-controller="MessengerCtrl" class="wrapper">
  <div class="col-sm-3 col-lg-2 no-padding channel-section">
    <div class="right-section">
      <div class="right-section-header" uib-dropdown>
        <img src="static/img/tecom-logo.png" />
        <span class="brand-name-right-header">تیکام</span>
        <a uib-dropdown-toggle class="user-options-btn">
          <i class="zmdi zmdi-more-vert"></i>
        </a>
        <ul class="dropdown-menu user-options" uib-dropdown-menu aria-labelledby="simple-dropdown">
          <li ng-click="openModal('userProfile')">
            <a><i class="fa fa-user"></i>پروفایل من</a>
          </li>
          <li ng-show="isAdmin" ng-click="openModal('teamProfile')">
            <a><i class="fa fa-users"></i>مدیریت تیم</a>
          </li>
          <li ng-click="setNotificationPermission()" ng-show="shouldShowNotificationPermission()">
            <a><i class="fa fa-bell"></i>درخواست دسترسی اعلان‌ها</a>
          </li>
          <li ng-click="logout()">
            <a><i class="fa fa-sign-out"></i>خروج</a>
          </li>
        </ul>
      </div>
      <div class="right-section-main">
        <div ui-view="channels"></div>
      </div>
    </div>
  </div>
  <div class="col-sm-9 col-lg-10 no-padding chat-section">
    <div ui-view></div>
  </div>
  <div class="loading" ng-show="isLoading">
    <img class="loading-img" src="static/img/loading.gif">
    <div class="loading-txt">تمرکز روی همه چیز، همون تمرکز روی هیچ چیزِ.</div>
  </div>
</div>
<div class="clearfix"></div>

<!-- User profile modal -->
<script type="text/ng-template" id="userProfile.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" ng-click="closeModal()">&times;</button>
    <h4 class="modal-title">پروفایل من</h4>
  </div>
  <div class="modal-body two-part-modal profile-modal">
    <div class="container-fluid u-profile">
      <div class="col-sm-10  col-sm-offset-1">
        <div class="col-sm-3">
          <div class="profile-modal-img">
            <a type="file" ngf-select="uploadProfileImage($file, $invalidFiles)" ngf-max-size="1MB">
              <img ng-src="{{user.image}}">
              <i class="zmdi zmdi-camera"></i>
            </a>
          </div>
        </div>
        <div class="col-sm-9">
          <div class="info no-padding">
            <div class="col-sm-3 no-padding">
              <label>ایمیل:</label>
            </div>
            <div class="col-sm-9">
              <label class="label">{{user.email}}</label>
            </div>
            <div class="clearfix"></div>
            <div class="col-sm-3 no-padding">
              <label>نام کاربری:</label>
            </div>
            <div class="col-sm-9">
              <div class="relative-parent profile-info">
                <form ng-submit="saveUsername()">
                  <label class="label">@</label>
                  <input type="text" ng-value="user.username" ng-disabled="!editUsernameActive" class="input-text title p-input" ng-model="usernameInput" />
                  <button ng-hide="editUsernameActive" class="btn-modal" ng-click="editUsername()">
                    <span class="zmdi zmdi-edit"></span>
                    <span>ویرایش نام کاربری</span>
                  </button>
                  <button ng-show="editUsernameActive" type="submit" class="btn-modal no-style" ng-click="saveUsername()">
                    <span class="zmdi zmdi-check"></span>
                    <span>ذخیره</span>
                  </button>
                </form>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>
        </div>
        <div class="clearfix"></div>
        <div class="col-sm-3"></div>
        <div class="col-sm-9">
          <div>
            <div class="modal-input">
              <button ng-show="!changePasswordActive" type="button" class="btn btn-default modal-btn change-pass-btn no-style" ng-click="changePassword()">تغییر رمز عبور</button>
            </div>
            <div ng-show="changePasswordActive" class="change-pass">
              <form name="forms.password" ng-submit="savePassword()" novalidate>
                <div class="col-sm-5">
                  <label>رمز عبور فعلی</label>
                </div>
                <div class="col-sm-7">
                  <div class="modal-input">
                    <input type="password" ng-model="oldPasswordInput" class="no-margin" />
                  </div>
                </div>
                <div class="clearfix"></div>
                <div class="col-sm-5">
                  <label>رمز عبور جدید</label>
                </div>
                <div class="col-sm-7">
                  <input type="password" ng-model="newPasswordInput" class="no-margin" />
                </div>
                <div class="clearfix"></div>
                <div class="col-sm-5">
                  <label>تکرار رمز عبور جدید</label>
                </div>
                <div class="col-sm-7">
                  <input type="password" ng-model="confirmPasswordInput" class="no-margin" />
                </div>
                <div class="clearfix"></div>
                <input type="submit" value="ذخیره رمز عبور" />
              </form>
            </div>
            <span class="modal-err" ng-show="showErrorMessage">{{errorMessage}}</span>
            <span ng-show="showInfoMessage">{{infoMessage}}</span>
          </div>
        </div>
        <div class="clearfix"></div>
        <div class="leave">
          <br >
          <div class="col-sm-3">
          </div>
          <div class="col-sm-9">
            <confirm-dialog button-name="خروج از تیم" class="danger-btn" message="مطمئنی که می خوای این تیم رو ترک کنی؟" cancel="نه، حواسم نبود" ok="آره" confirm-button="danger" confirm-func="leaveTeam"></confirm-dialog>
          </div>
          <div class="clearfix">
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<!-- Team profile modal -->
<script type="text/ng-template" id="teamProfile.html">

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" ng-click="closeModal()">&times;</button>
    <h4 class="modal-title">مدیریت {{team.name}}</h4>
  </div>
  <div class="modal-body two-part-modal profile-modal">
    <div class="container-fluid u-profile">
      <div class="col-sm-10 col-sm-offset-1">
        <div class="t-info">
          <div class="g-members">
            <div ng-repeat="member in teamMembers | orderBy : 'user.username'" class="g-m-one">
              <img ng-src="{{member.user.image || '/static/img/user-def.png'}}" />
              <label>@{{member.user.username}}</label>
              <div ng-hide="isMe(member)" style="float: left">
                <confirm-dialog ng-class="getAdminButtonCSS(member)" class="t-m-btn" message='{{member.isAdmin ? "مطمئنی میخوای \"@" + member.user.username + "\" دیگه ادمین نباشه؟" : "مطمئنی میخوای \"@" + member.user.username + "\"  ادمین بشه؟"}}' cancel="نه، حواسم نبود" ok="آره"
                  args="[member]" confirm-func="changeMemberAdminState" confirm-button='{{member.isAdmin ? "danger" : "success"}}' icon="fa fa-diamond"></confirm-dialog>
                <confirm-dialog class="t-m-btn" message='مطمئنی میخوای "@{{member.user.username}}" رو حذف  کنی؟' cancel="نه، حواسم نبود" ok="آره" args="[member]" confirm-func="removeTeamMember" confirm-button="danger" icon="zmdi zmdi-close"></confirm-dialog>
              </div>
            </div>
          </div>
          <form name="forms.inviteMember" class="t-ms" ng-submit="sendInvitation()" novalidate>
            <div class="col-md-2"></div>
            <div class="col-sm-7 col-md-5 no-padding">
              <div>
                <input type="text" name="email" ng-model="invitedEmail" placeholder="ایمیل هم‌تیمی جدیدت رو وارد کن..." required/>
              </div>
              <div class="modal-msg-part">
                <span class="modal-msg modal-err" ng-show="showErrorMessage">{{errorMessage}}</span>
                <span class="modal-msg" ng-show="showInfoMessage">{{infoMessage}}</span>
              </div>
            </div>
            <div class="col-sm-5 col-md-3 no-padding">
              <div class="input-modal">
                <input type="submit" value="دعوت به تیم" />
              </div>
            </div>
            <div class="col-md-2"></div>
          </form>

        </div>
      </div>
    </div>
  </div>
</script>
